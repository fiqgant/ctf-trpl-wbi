# ctf-ts

TypeScript CTF competition with 10 levels.

## Core design
- Flag format: `CTF{...}`
- One unique deterministic flag per level
- Flag derivation depends on `CTF_FLAG_SALT`
- Online levels run on Vercel API functions
- Offline levels are generated by Node.js TypeScript scripts
- Reverse levels use AssemblyScript -> WebAssembly

## Difficulty curve
- Easy: Level 01-03
- Medium: Level 04-06
- Hard: Level 07-08
- Very Hard: Level 09-10

## Level map
1. `L01` Easy - Misc/Encoding (offline)
2. `L02` Easy - Web logic (online)
3. `L03` Easy - Forensics logs (offline)
4. `L04` Medium - Authorization token logic (online)
5. `L05` Medium - Toy crypto stream-key reuse (online)
6. `L06` Medium - Reverse engineering WASM (offline)
7. `L07` Hard - XOR keystream reuse (offline)
8. `L08` Hard - Web + forensics fragment reconstruction (online)
9. `L09` Very Hard - Reverse engineering WASM (offline)
10. `L10` Very Hard - Multi-step chain (online)

## Repository layout
- `shared/`: shared flag, crypto, and rate-limit utilities
- `apps/web/`: static challenge index + downloadable artifacts
- `apps/worker/`: reusable route handlers for the API
- `api/[...route].ts`: Vercel API router for `/api/*`
- `levels/`: challenge docs, solutions, hints, and generators
- `scripts/build-all.ts`: runs offline generators and copies outputs


## Online endpoints
- `/api/level02`
- `/api/level04`
- `/api/level05`
- `/api/level08`
- `/api/level10`

## Offline artifacts
Generated into each `levels/levelXX/dist/` folder and copied to:
- `apps/web/public/downloads/level01`
- `apps/web/public/downloads/level03`
- `apps/web/public/downloads/level06`
- `apps/web/public/downloads/level07`
- `apps/web/public/downloads/level09`

## Safety model
- No remote code execution
- No command injection surface
- No arbitrary file upload
- No public internet SSRF
- No brute-force challenge design
- Rate limit enforced on each online level route
- Fictional data only

## Flag derivation API
Implemented in `shared/src/flag.ts`:
- `deriveFlag(levelId, proof, salt)`
- `deriveFlagFromEnv(levelId, proof, env)`

All API routes and offline generators use this same utility.

## Deployment
Vercel deployment steps are in `deployment/vercel.md`.

## Environment variables
Set these in local dev and in Vercel Project Settings:

```bash
export CTF_FLAG_SALT="<strong-random-secret>"
export L02_EXPECTED_ANSWER="<private-answer-l02>"
export L04_EXPECTED_ANSWER="<private-answer-l04>"
export L05_EXPECTED_ANSWER="<private-answer-l05>"
export L08_EXPECTED_ANSWER="<private-answer-l08>"
export L10_EXPECTED_ANSWER="<private-answer-l10>"
```

Start from `.env.example`, fill private values, and never commit real answers.
